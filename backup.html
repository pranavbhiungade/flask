<!-- <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grouped SOPs - Home</title>
  <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      margin: 0;
      padding: 0;
      color: #e0e0e0;
    }

    .container {
      max-width: 1200px;
      margin: 40px auto;
      background: #1e1e1e;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.6);
      padding: 32px;
    }

    h1 {
      color: #00bcd4;
      text-align: center;
      margin-bottom: 24px;
    }

    h3 {
      margin: 24px 0 12px 0;
      color: #ffffff;
      font-weight: bold;
      text-align: left;
      border-left: 4px solid #00bcd4;
      padding-left: 10px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 24px;
      border: 1px solid #333;
      background: #1a1a1a;
    }

    th,
    td {
      border: 1px solid #333;
      padding: 10px 12px;
      text-align: left;
      font-size: 14px;
      color: #e0e0e0;
    }

    th {
      background: #2c2c2c;
      font-weight: 600;
      color: #00bcd4;
    }

    tr:nth-child(even) {
      background: #2a2a2a;
    }

    tr:nth-child(odd) {
      background: #1e1e1e;
    }

    tr:hover {
      background: #333;
    }

    a {
      color: #03a9f4;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
      color: #29b6f6;
    }

    .loading,
    .no-data {
      text-align: center;
      padding: 20px;
      font-style: italic;
      color: #aaa;
    }

    .action-btn {
      padding: 6px 10px;
      margin: 0 4px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .edit-btn {
      background: #2196f3;
      color: white;
    }

    .edit-btn:hover {
      background: #42a5f5;
    }

    .delete-btn {
      background: #f44336;
      color: white;
    }

    .delete-btn:hover {
      background: #ef5350;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>SOPs</h1>
    <div id="sops-content" class="loading">Loading...</div>
  </div>

  <script>
    async function fetchGroupedSOPs() {
      try {
        const response = await fetch("http://192.168.64.1:5000/home");
        if (!response.ok) throw new Error("Network response was not ok");

        const data = await response.json();
        const container = document.getElementById("sops-content");
        container.innerHTML = "";

        if (!data.length) {
          container.innerHTML = '<div class="no-data">⚠️ No SOPs found.</div>';
          return;
        }

        let html = "";

        data.forEach(serviceObj => {
          serviceObj.versions.forEach(versionObj => {
            html += `<h3>${serviceObj.service} | ${versionObj.version}</h3>`;

            html += `<div style="overflow-x:auto;"><table><thead><tr>
              <th>ID</th>
              <th>Alert_Name</th>
              <th>Title</th>
              <th>Description</th>
              <th>SOP</th>
              <th>Created By</th>
              <th>Last Modified By</th>
              <th>Created At</th>
              <th>Updated At</th>
              <th>Actions</th>
            </tr></thead><tbody>`;

            versionObj.sops.forEach(sop => {
              html += `<tr>
                <td>${sop.id}</td>
                <td>${sop.alert_name}</td>
                <td>${sop.sop_title}</td>
                <td>${sop.sop_description || '-'}</td>
                <td>
                    ${sop.sop_link
                  ? `<button onclick="showSOPModal(${encodeURIComponent(JSON.stringify(sop))})" class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-3 py-1.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Open</button>`
                  : '-'}
                </td>
                <td>${sop.created_by || '-'}</td>
                <td>${sop.last_modified_by || '-'}</td>
                <td>${sop.created_at}</td>
                <td>${sop.updated_at}</td>
                <td style="display:flex;gap:8px;align-items:center;justify-content:left;">
                  <button class="action-btn edit-btn" title="Edit" onclick="editSOP(${sop.id})" style="display:inline-flex;align-items:center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M4 21h17v2H3a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h2v2H4v17zm16.7-13.3a1 1 0 0 0 0-1.4l-2-2a1 1 0 0 0-1.4 0l-9.6 9.6a1 1 0 0 0-.3.6l-.7 4.2a1 1 0 0 0 1.2 1.2l4.2-.7a1 1 0 0 0 .6-.3l9.6-9.6zm-3.3-1.3 2 2-1.3 1.3-2-2L17.4 6.4zm-9 9 6.6-6.6 2 2-6.6 6.6-2.5.4.5-2.4z"/></svg>
                  </button>
                  <button class="action-btn delete-btn" title="Delete" onclick="deleteSOP(${sop.id})" style="display:inline-flex;align-items:center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M5 6h14v2H5V6zm2 3h10l-1.5 12.5a1 1 0 0 1-1 .5h-5a1 1 0 0 1-1-.5L7 9zm3 2v7h2v-7h-2z"/></svg>
                  </button>
                </td>
              </tr>`;
            });

            html += "</tbody></table></div>";
          });
        });

        container.innerHTML = html;
      } catch (error) {
        document.getElementById("sops-content").innerHTML =
          '<div class="no-data">❌ Failed to load SOPs. Please try again.</div>';
        console.error("Error fetching SOPs:", error);
      }
    }

    function editSOP(id) {
      alert("Edit SOP with ID: " + id);
      // TODO: open a modal or redirect to an edit form
    }

    function deleteSOP(id) {
      if (confirm("Are you sure you want to delete SOP ID " + id + "?")) {
        alert("Deleting SOP with ID: " + id);
        // TODO: make a DELETE request to your Flask backend
      }
    }

    function showSOPModal(sopJson) {
  const sop = JSON.parse(decodeURIComponent(sopJson));
  document.getElementById('sop-modal-title').textContent = sop.sop_title || 'SOP Details';
  document.getElementById('sop-modal-body').innerHTML = `
    <div class="mb-2"><span class="font-semibold">Alert:</span> ${sop.alert_name || '-'}</div>
    <div class="mb-2"><span class="font-semibold">Description:</span> ${sop.sop_description || '-'}</div>
    <div class="mb-2"><span class="font-semibold">Link:</span> ${sop.sop_link ? `<a href="${sop.sop_link}" target="_blank" class="text-blue-600 underline">Open SOP</a>` : '-'}</div>
    <div class="mb-2"><span class="font-semibold">Created By:</span> ${sop.created_by || '-'}</div>
    <div class="mb-2"><span class="font-semibold">Last Modified By:</span> ${sop.last_modified_by || '-'}</div>
    <div class="mb-2"><span class="font-semibold">Created At:</span> ${sop.created_at || '-'}</div>
    <div class="mb-2"><span class="font-semibold">Updated At:</span> ${sop.updated_at || '-'}</div>
  `;
  document.getElementById('sop-modal').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}
function hideSOPModal() {
  document.getElementById('sop-modal').classList.add('hidden');
  document.body.style.overflow = '';
}

    fetchGroupedSOPs();
  </script>

<div id="sop-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
  <div class="relative p-4 w-full max-w-2xl max-h-full">
    <div class="relative bg-white rounded-lg shadow-sm dark:bg-gray-700">
      <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600 border-gray-200">
        <h3 id="sop-modal-title" class="text-xl font-semibold text-gray-900 dark:text-white"></h3>
        <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" onclick="hideSOPModal()">
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
      </div>
      <div class="p-4 md:p-5 space-y-4" id="sop-modal-body">
        
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
</body>

</html> -->